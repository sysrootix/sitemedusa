# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏ –ø–æ–¥—Å—á–µ—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

## –î–∞—Ç–∞: 2 –æ–∫—Ç—è–±—Ä—è 2025

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç "–î–æ—Å—Ç—É–ø–Ω–æ –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö"

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ VooPoo Drag 5 (177W, –±–µ–∑ –ê–ö–ë)
6 935 ‚ÇΩ
–î–æ—Å—Ç—É–ø–Ω–æ –≤ 40 –º–∞–≥–∞–∑–∏–Ω–∞—Ö
–í—Å–µ–≥–æ –≤ –Ω–∞–ª–∏—á–∏–∏: 0 —à—Ç.  ‚ùå
```

**–ü—Ä–∏—á–∏–Ω–∞:**
`available_shops_count` —Å—á–∏—Ç–∞–ª **–≤—Å–µ –º–∞–≥–∞–∑–∏–Ω—ã** –≥–¥–µ —Ç–æ–≤–∞—Ä –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ, –¥–∞–∂–µ –µ—Å–ª–∏ `quantity = 0`.

**–†–µ—à–µ–Ω–∏–µ:**
–ò–∑–º–µ–Ω–∏–ª–∏ –ª–æ–≥–∏–∫—É –ø–æ–¥—Å—á–µ—Ç–∞ –≤ `backend/src/controllers/catalogController.ts`:

```typescript
// –ë–´–õ–û:
available_shops_count: product.shops.length

// –°–¢–ê–õ–û:
available_shops_count: product.shops.filter((shop: any) => shop.quanty && shop.quanty > 0).length
```

–¢–µ–ø–µ—Ä—å —Å—á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–∞–≥–∞–∑–∏–Ω—ã –≥–¥–µ `quantity > 0`.

---

### 2. üé® –°–µ–ª–µ–∫—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–æ–≤ —Ç–µ–ø–µ—Ä—å –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ

**–ë—ã–ª–æ:**
- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π
- –ù–µ—É–¥–æ–±–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- –ü–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞–∂–¥–æ–º –º–∞–≥–∞–∑–∏–Ω–µ

**–°—Ç–∞–ª–æ:**
- –ö—Ä–∞—Å–∏–≤–æ–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –≥–æ—Ä–æ–¥—É –∏ –∞–¥—Ä–µ—Å—É
- –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
- –ë–ï–ó –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Ñ–æ–Ω–∞

**–ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:** `frontend/src/components/ShopSelectorModal.tsx`

---

### 3. üî¢ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å NaN

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
–í—Å–µ–≥–æ –≤ –Ω–∞–ª–∏—á–∏–∏: NaN —à—Ç.
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–µ–π `quantity` –∏ `quanty` –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –∫–æ–¥–∞ –ø—Ä–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è `quanty` –≤–æ –≤—Å–µ—Ö reduce-—Ñ—É–Ω–∫—Ü–∏—è—Ö:

```typescript
total_quantity: product.shops.reduce((sum: number, shop: any) => sum + (shop.quanty || 0), 0)
```

---

### 4. üí∞ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∞—Ä—Å–∏–Ω–≥ —Ü–µ–Ω –∏–∑ 1–°

**–ü—Ä–æ–±–ª–µ–º–∞:**
–¶–µ–Ω—ã –æ—Ç 1–° –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ `"3 929,00"` (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏), –∞ `parseFloat()` –ø–∞—Ä—Å–∏–ª —Ç–æ–ª—å–∫–æ –¥–æ –ø—Ä–æ–±–µ–ª–∞ ‚Üí `3‚ÇΩ` –≤–º–µ—Å—Ç–æ `3929‚ÇΩ`.

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤ –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º:

```typescript
// –ë–´–õ–û:
parseFloat(String(retail_price).replace(',', '.'))  // "3 929,00" ‚Üí 3

// –°–¢–ê–õ–û:
parseFloat(String(retail_price).replace(/\s+/g, '').replace(',', '.'))  // "3 929,00" ‚Üí 3929
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

**Backend:**
- `backend/src/controllers/catalogController.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
- `backend/src/services/catalogSyncService.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ —Ü–µ–Ω —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –ø—Ä–æ–±–µ–ª–æ–≤

**Frontend:**
- `frontend/src/components/ShopSelectorModal.tsx` - **–ù–û–í–´–ô** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
- `frontend/src/pages/CatalogHierarchical.tsx` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π `ShopSelectorModal`
- `frontend/src/components/ProductModal.tsx` - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ
- `frontend/src/components/ShopSelector.tsx` - **–£–°–¢–ê–†–ï–õ** (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ ShopSelectorModal:

‚úÖ –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
‚úÖ –ü–æ–∏—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –≥–æ—Ä–æ–¥, –∞–¥—Ä–µ—Å)
‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ (1 –∫–æ–ª–æ–Ω–∫–∞ ‚Üí 2 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö)
‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Ñ–æ–Ω–∞
‚úÖ –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ backdrop –∏–ª–∏ –∫–Ω–æ–ø–∫—É X
‚úÖ –ò–Ω–¥–∏–∫–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
‚úÖ –û–ø—Ü–∏—è "–í—Å–µ –º–∞–≥–∞–∑–∏–Ω—ã" —Å–≤–µ—Ä—Ö—É
‚úÖ –ë–ï–ó –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

```typescript
<ShopSelectorModal
  shops={shops}                    // –°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
  selectedShop={selectedShop}      // –í—ã–±—Ä–∞–Ω–Ω—ã–π shop_code –∏–ª–∏ null
  onSelectShop={handleShopChange}  // Callback –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
  isOpen={showShopSelector}        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å/—Å–∫—Ä—ã–≤–∞—Ç—å modal
  onClose={() => setShowShopSelector(false)}  // Callback –∑–∞–∫—Ä—ã—Ç–∏—è
/>
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ (—Ç–æ–ª—å–∫–æ —Å —Ç–æ–≤–∞—Ä–æ–º –≤ –Ω–∞–ª–∏—á–∏–∏)
‚úÖ –ö—Ä–∞—Å–∏–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–∞–≥–∞–∑–∏–Ω–∞
‚úÖ –£–¥–æ–±–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ü–µ–Ω—ã (3929‚ÇΩ –≤–º–µ—Å—Ç–æ 3‚ÇΩ)
‚úÖ –ù–µ—Ç NaN –≤ –æ—Å—Ç–∞—Ç–∫–∞—Ö
‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

